# fastapi-shop_and_delivery
Простенький REST API, моделирующий базовые функции интернет магазина. Интернет магазина, который осуществляет перевозку
заказов из одного единственного склада в один единственный пункт выдачи. Для упрощения работы с товарами и грузовиками
было принято решение перенести данный магазин в 2D (плоский) мир. Интерфейс основан на библиотеке Fast API Python.

Для запуска приложения:

1) Если в папке \app\databases отсутствует база данных main_database_test.db, то проверьте, что в файле app\main.py 
не закомментирована строчка №21 'lifespan=lifespan,'. Если база данных присутствует в папке, то наоборот, закомментируйте
данную строку.
2) Установить необходимые пакеты из списка requirements.txt
3) В терминале перейдите в папку с проектом 'fastapi-shop_and_delivery'. Активируйте виртуальное окружение source .venv/bin/activate
(для Windows: .\venv\Scripts\activate).
4) Запустите интерфейс командой fastapi dev app\main.py (windows)

Система хранения представляет собой базу данных, состоящую из 7 связанных таблиц:

-User - таблица с данными о пользователях сервиса, такими как: имя пользователя, адрес электронной почты (один пользователь
на одну почту), уровень доступа,
список заказов, список продаваемых пользователем товаров (если пользователь обладает уровнем доступа 'provider' или 'admin'). 
По счастливой случайности, все пользователи, которые оформили заказ в данном магазине, живут рядом с тем единственным 
пунктом выдачи заказов, поэтому не нужно указывать адрес проживания. При удалении пользователя из системы все его
заказы и товары так же удаляются (*).

-Access Level - всего 3 уровня доступа: 'customer' - может получить и изменить данные о себе (имя и почта), получить
список товаров на сайте, найти товар по id, создать свой заказ, получить информацию о своих заказах и найти свой заказ 
по id, удалить (* ) свой заказ, 'provider' - может то же, что и 'customer', плюс создать, изменить и удалить (* ) свой
товар, 'admin' - права 'provider' плюс может изменить уровень доступа пользователей, 
удалить (*) пользователей (но не себя), может получить, изменить и удалить
информацию о чужих заказах и товарах, а также может добавить и убрать машины из автопарка, создать и отменить перевозку.


-Product - таблица с данными о товарах на сайте, а именно: название товара (одно имя на один товар),
размер товара (size_x и size_y), разрешение на поворот товара во время перевозки, список заказов с данным товаром,
создавший товар пользователь. При удалении товара удаляются и связанные с ним заказы (*). 
!ВАЖНО! - вы не сможете добавить новый товар, если у магазина нет грузовика, который бы смог вместить добавляемый товар.

-Order - содержит оформившего заказ пользователя, заказанный товар, дату оформления заказа, пометка о нахождении товара на складе или в процессе 
доставки (on_the_way), номер грузовика (если заказ находится в процессе доставки), информацию о доставке
(если заказ находится в процессе доставки).

-Truck - содержит информацию о размере грузовика (size_x и size_y), цену за перевозку, список загруженных заказов
(если грузовик находится в процессе доставки), информацию о доставке (если грузовик находится в процессе доставки).

-Delivery - содержит информацию о номере доставки, заказах и грузовиках, находящихся в процессе перевозки. !ВАЖНО! - 
невозможно удаление заказов и грузовиков, если они находятся в процессе доставки (относится ко всем пунктам, помеченным *)
(если у пользователя есть заказ или товар, которые находятся в процессе переозки, то пользователя удалить нельзя)(аналогично 
с товаром)

В файле er.png представлена ER-диаграмма данной базы данных.

Разберем несколько не столь очевидных эндпоинтов.

1) Безопасность auth/login. Несмотря на свое название, прохождение данного эндпоинта не предоставит вам доступ 
к ранее закрытым эндпоинтам. Для аутентификации необходимо воспользоваться кнопкой authoriz в правом части экрана. 
После чего вам откроется доступ к эндпоинтам (согласно вашему уровню доступа)
2) Patch-эндпоинты. Данные функции предоставляют возможность изменить данные о чем-либо в системе. Главное запомните,
что, если вы не желаете менять то или иное поле, то просто сотрите его из словаря. Например: при прохождении 
эндпоинта 'Работа с товарами' product/update/{id_product} вам будет показан пример запроса:
{
  "name": "string",
  "size_x": 0,
  "size_y": 0,
  "turn_permission": true
}. Если вы хотите изменить только имя товара ('name'), то уберите ненужные поля: 
{
  "name": "string"
}. 
3) 'Работа с перевозками' - особенный раздел. В нем присутствует всего три действия: получить информацию о перевозке,
создать перевозку и отменить перевозку. Причем создается перевозка без какой-либо дополнительной информации, передаваемой через
json-запрос. При создании перевозки из базы данных берутся все находящиеся на складе заказы и все доступные 
(не в процессе перевозки) грузовики. Все заказы сортируются по дате оформления. После чего специальная функция 
рассортирует как можно больше заказов по доступным грузовикам, причем приоритет будет у более ранних заказов.
После будет найдена самая выгодная (у каждого грузовика своя цена перевозки) конфигурация 'грузовик-заказ'.  



